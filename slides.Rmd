---
title: "DSCI 521 - Lecture 8"
subtitle: "Getting help, virtual environments, and some tips and tricks"  
author: 
  - "MDS 2021/22"
output:
  xaringan::moon_reader:
    seal: false # saco filmina de inicio
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "https://platform.twitter.com/widgets.js"
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
library(xaringanExtra)
library(tidyverse)
library(knitr)
library(nomnoml)
library(countdown)
xaringanExtra::use_logo(
  image_url = "https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/xaringan.png"
)
xaringanExtra::use_panelset()
xaringanExtra::use_broadcast()
xaringanExtra::use_share_again()
xaringanExtra::style_share_again(share_buttons = c("twitter", "linkedin"))
xaringanExtra::use_tachyons()
xaringanExtra::use_fit_screen()
xaringanExtra::use_tile_view() # O
style_mono_accent(
  base_color = "#0dc96f",
  background_color = "#ffffff",
  inverse_background_color = "#3298cb",
  header_color = "#022044",
  inverse_header_color = "#ffffff", 
  inverse_text_color = "#ffffff",
  code_inline_color = "#179c55",
  link_color= "#0000FF",
  text_font_size = "25px",
  header_font_google = google_font("Poppins", "Regular", "400"),
  text_font_google   = google_font("Darker Grotesque", "500"),
  code_font_google   = google_font("Fira Mono"),
  )

```

```{r metathis, warning=FALSE, echo=FALSE}
# library(metathis)
# meta() %>%
#   meta_name("github-repo" = "flor14/rladies-jujuy") %>% 
#   meta_social(
#     title = "Meetup R-Ladies Jujuy",
#     description = paste(
#       "Mi próximo artículo científico con R:", 
#       "Compendios de Investigación, Reproducibilidad e",
#       "Interactividad en las publicaciones académicas"
#     ),
#     url = "https://flor14.github.io/rladies-jujuy/presentacion.html?panelset=licencia#1",
#     image = "https://res.cloudinary.com/flor/image/upload/v1608248822/jujuy-colores_frmvax.jpg",
#     image_alt = paste(
#       "Charla para el capítulo de R-Ladies de Jujuy, Argentina.",
#       "Diciembre de 2020"
#       ),
#     og_type = "website",
#     og_author = "Florencia D'Andrea",
#     twitter_card_type = "summary_large_image",
#     twitter_creator = "@cantoflor_87",
#     twitter_site = "@cantoflor_87"
#   )
```




class: middle, center

```{r hex, fig.align='center', echo = FALSE, out.width=150} 
    knitr::include_graphics("img/hex.png")
```


---


class: bottom

.bg-washed-blue.b--dark-blue.ba.bw2.br3.shadow-5.ph4.mt5[
### DSCI 521 - Lecture 8 
### **Getting help, virtual environments, and some tips and tricks**

 .large[#### Computing Platforms for Data Science - UBC MDS 2021/22
]]


---

## Lecture learning goals

1. Access function documentation.
--

2. Ask questions effectively.

--
3. Create a minimal reproducible examples.

--
4. Manage virtual environments with conda and renv.
---

class: middle, inverse

## Accessing help in R and Python

---
## Accessing help in R and Python

In R, yo can use `?` to view the documentation (the "docstring"), e.g. ?len or ?seq. 
In Python, you can put the `?` either before or after the object in Python, and if you use two ?? you can view the source code as well.

Since it is not always convenient to type out the ?, there are shortcuts in common IDEs to view the docstrings. In RStudio, you can press F1 as you type a function or look it up in the help right away. In JupyterLab, you can press Shift + TAB or have the contextual help open on the side as you type.

---

## Asking effective questions
#### Why even bother?
Asking questions effectively means that the person helping you will be able to answer your question better and quicker. Being able to answer a question quicker means more time to help others, including your future self. When questions require clarification, fewer people will be helped overall. Sometimes this in unavoidable because the question is complex, but all too often it if because the person trying to help is not able to reproduce problem, or the question is unclear.

When you are asking for help online, e.g. on StackOverflow or on GitHub, remember that you are often receiving help from people who are volunteering their time. So please make it as easy as possible for them to help you.

You might be frustrated by a problem to the point where you just want to as

---


You might be frustrated by a problem to the point where you just want to ask something like.

WHY IS THIS **** CODE NOT WORKING??????

Don't do this.
No one will help you.
You will get more frustrated.

---


```{r ch2, fig.align='center', echo = FALSE, out.width=800} 
    knitr::include_graphics("img/code_hero.jpg")
```

.footnote[[Illustration by Alison Horst](https://github.com/allisonhorst)]


---


When I feel like this, I find it really helpful and calming to sit down and type out a proper question. You can start banging out words in the beginning, but as you slowly adhere to the format of asking properly, it will become like a meditative practice which also calms you down.

In addition to your mental wellbeing, writing down questions properly has another superb quality: they help you solve your own problems. The act of formulating a question in either speech or text helps you uncover what you missed while the problem was a mere thought. This is so common that it has a name: "Rubber duck debugging" allegedly from a software developer who put a rubber duck on their desk and whenever they had a problem they couldn't solve, they starting talking to the toy duck, and often came upon the resolution during while describing the problem.

---

## How to ask effectively
In essence, you want to make your question as easy to understand as possible and your specific problem as easy to reproduce as possible. If you just include a screenshot and title your question "Help", the person helping you has to spend time trying to figure out what you actually want help with instead of helping, Instead include a succinct, clear description of your problem and the minimal code needed to reproduce it. If you are asking your question on stack overflow you can use tags to categorize it, and these can then be used to search for an answer via the syntax [tag-name]. This can be especially useful for R, since the name is just one letter and it can be hard to find relevant matches otherwise.

---
### Minimal reproducible example
There is a Swedish expression: "beloved child has many names". No, it does not translate very well to English, but the message is that someone or something that many people like, will be referred to differently by different people. This is true for minimal reproducible examples, which you might find referred to by any of the following:

- MRE Minimal Reproducible Example
- MCVE Minimal Complete Verifiable Example
- MWE Minimal Working Example
- reprex REPRoducible EXample

There have been great articles written on what goes into an MRE, and here are some of them that I recommend that you check out:
---
### Minimal reproducible example

https://stackoverflow.com/help/how-to-ask
https://stackoverflow.com/help/minimal-reproducible-example
https://community.rstudio.com/t/faq-whats-a-reproducible-example-reprex-and-how-do-i-do-one/5219
https://reprex.tidyverse.org/ (an R package to help creating MREs from code)
In summary, asking effectively and creating an MRE includes the following tasks:


---

### Minimal reproducible example
- Search for other questions similar to yours.

-- 

- Describe the issue clearly in the title and elaborate briefly in the text body.

--

- Reduce the code to the minimum required to recreate your error, and paste it as text.

--

- If your code includes functions or classes, include their definitions.

--

- Create small toy dataset instead of using real data.

---


### Minimal reproducible example

- Use markdown code blocks for proper indentation and syntax highlighting.

--
- Describe what you have tried so far, what you don't understand or what went wrong, including any error messages and their full traceback.

--

- The points are elaborated on below:

--
- Search for other questions similar to yours. Many questions already have an answer, and finding it is faster both for you and for others. If the answer to an existing question is not good enough, improve it by adding the missing info!
- Write the tile as a summary of your issue. Think about what you would want the title to say if you were searching the issue list for help. Just "Error" or "Question" is not helpful, but "How to list content in a folder?" is.
- Introduce the problem by briefly describing what you want to do.

---


### Minimal reproducible example

- Show what you have tried, explain what you expected to happen, and what went wrong. It is often critical that the person helping you can reproduce the problem, so include both the code or command you tried to run and the error message.
- For coding questions, text is preferred over a screenshot since it is easy to copy and paste, which facilitates reproducing your problem.
- Inline code should be surrounded by single backticks for clarity. Longer blocks of code with multiple lines should be surrounded by triple backticks.
- Include versions of any packages you are using, and the operating system if relevant, e.g. Win10, Python 3.8, pandas 1.0.2. On R you can use devtools::session_info() to see this information (after install.packages("devtools")). and on Python you can use sinfo() (after importing: from sinfo import sinfo, needs to be installed via pip install sinfo).
- When your problem is solved, acknowledge the solution, close the issue/ticket/question. If you found the solution yourself, post it in a comment before closing, so that others can find it.



---

class: middle, center

### Virtual environments

---

## Virtual environments

Virtual environments let's you have multiple versions of packages and programs on the same computer without them creating conflicts with each other. You will be using virtual Python and R environments throughout the program to setup your packages for different courses.

---

## Conda 

conda is an open source package and **environment management system** for any programming language; though it is the most popular in the python community. 

---
## Conda

```{r anac, fig.align='center', echo = FALSE, out.width=500} 
    knitr::include_graphics("img/miniconda_vs_anaconda.png")
```

- **Anaconda** is a data science platform for Python that comes with a lot of packages by default. 
- **Miniconda** doesn't come with any installed packages by default, and we can pick and choose which ones we want. 

Both include Python and conda.


.footnote[[Introduction to Conda for (Data) Scientists - Software Carpentry](https://carpentries-incubator.github.io/introduction-to-conda-for-data-scientists/01-getting-started-with-conda/index.html)]

---

## Managing Conda


What version of conda is installed?

```
conda --version
```
Conda commands are available, type conda --help. 

```
conda update --help
```
- Update our conda to the latest version: 

```
conda update conda
```



---

## Managing Conda

```
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata: ....
.Solving package specifications: .........

Package plan for installation in environment //anaconda:

The following packages will be downloaded:

    package                    |            build
    ---------------------------|-----------------
    conda-env-2.6.0            |                0          601 B
    ruamel_yaml-0.11.14        |           py27_0         184 KB
    conda-4.2.12               |           py27_0         376 KB
    ------------------------------------------------------------
                                           Total:         560 KB

```

---

class: middle, center

### What is a conda environment and why is it so useful?
Using conda, you can create an `isolated python environment for your project`. 


---

## What is an Environment?
- An environment is a set of packages that can be used in one or multiple projects. There are several major benefits of using environments:
--
- You can guarantee that someone else can reproduce your project by specifying which package versions your used and making it easy for others to install the same versions.
--
- If two of your projects relies on different versions of the same package, you can install these in different environments.
--
- If you want to play around with a new package, you don't have to change the packages you use for your data analysis and risk messing something up.
--
- When you develop your own packages, it is essential to use environments, since you want to to make sure you know exactly which packages yours depend on, so that it runs on other systems than your own.


---

## Base environment

Conda has a default environment called **base**
- that include a Python installation 
- and some core system libraries and dependencies of Conda. 

It is a “best practice” to avoid installing additional packages into your base software environment. 
 

---

## Creating Conda environments

There are two ways of creating a conda environment.



1. Creating environment by manually specifying packages  

--
2. An environment file in YAML format (*environment.yaml*).

---

## 1. Creating environment by manually specifying packages
We can create `test_env` conda environment by typing `conda -n <name-of-env>`. 

```
conda create -n test_env -c conda-forge python=3.7 jupyterlab pandas=1.0.2
```
- conda will solve any dependencies between the packages like before and create a new environment with those packages. 
- Usually, we don't need to specify the channel, but in this case I want to get the very latest version of these packages, and they are made available in `conda-forge` before they reach the default conda channel.

---

## 1. Creating environment by manually specifying packages

To activate this new environment, you can type

```
conda activate test_env 
```

```
conda deactivate 
```

To see all your environments, you can type:

```
conda env list
```
---
## 2. An environment file in YAML format (*environment.yaml*).

Exporting your environment to a file called `environment.yaml` (it could be called anything, but this is the conventional name and using it makes it easy for others to recognize that this is a conda env file, the extension can be either .yaml or .yml):

---


## Sharing Environments with others
To share an environment, you can export your conda environment to an environment file, which will list each package and its version in the format package=version=build.


```
conda env export -f environment.yaml
```
Remember that `.yaml` files are plain text, so you can use a text editor such as VS Code to open them. If you do, you will realize that this environment file has A LOT more packages than jupyterlab and pandas. This is because the default behavior is to also list the dependencies that were installed together with these packages, e.g. numpy. This is good in the sense that it gives an exact copy of everything in your environment.


---

## Sharing Environments with others

Exporting your environment to a file called **environment.yaml** (the extension can be either .yaml or .yml):

```
conda env export -f environment.yaml
```
---
## Sharing Environments with others
However, some dependencies might differ between operating systems, to remedy this, we can append the `--from-history flag`, which look at the history of the packages you explicitly told conda to install and only list those in the export. 
The required dependencies will then be handled in an OS-specific manner during the installation, which guarantees that they will work across OSes. This environment.yaml file would be much shorter and look something like this:

```
name: test_env
channels:
  - conda-forge
  - defaults
dependencies:
  - conda
  - python=3.7
  - pandas==1.0.2
  - jupyterlab
```
Importantly, this will not include the package version unless you included it when you installed with the package==version syntax. For an environment to be reproducible, you NEED to add the version string manually.

---
### Creating environment from an environment file
Now, let's install `environment.yaml` environment file above so that we can create a conda environment called `test_env`.
```
$ conda env create --file environment.yaml
```

Copying an environment
We can make an exact copy of an environment to an environment with a different name. This maybe useful for any testing versus live environments or different Python 2.7 versions for the same packages. In this example, test_env is cloned to create live_env.
```
conda create --name live_env --clone test_env
```

---
## Deleting an environment
Since we are only testing out our environment, we will delete live_env to remove some clutter. Make sure that you are not currently using live_env.
```
conda env remove -n live_env
```

---

## Making environments work well with JupyterLab
In brief, you need to install the `ipykernel` package in any new environment your create, and the nb_conda_kernels package needs to be installed in the environment where JupyterLab is installed.

By default, JupyterLab only sees the conda environment where it is installed. Since it is quite annoying to install JupyterLab and its extensions separately in each environment, there is a package called nb_conda_kernels that makes it possible to have a single installation of JupyterLab access kernels in other conda environments. This package needs to be installed in the conda environment where JupyterLab is installed.

Lastly, you also need to install a kernel in the new conda environment so that it can be detected by nb_conda_kernels. This kernel can be installed via the package ipykernel for Python and the r-irkernel package for R (more info in the nb_conda_kernels README).
---
## Managing Packages
#### Seeing what packages are available
We will now check packages that are available to us. The command below will list all the packages in an environment, in this case test_env. The list will include versions of each package, the specific build, and the channel that the package was downloaded from. conda list is also useful to ensure that you have installed the packages that you desire.
```
conda list
```
```bash
# packages in environment at //miniconda/envs/test_env:
#
Using Anaconda Cloud api site https://api.anaconda.org
blas                      1.1                    openblas    conda-forge
ca-certificates           2016.9.26                     0    conda-forge
certifi                   2016.9.26                py27_0    conda-forge
cycler                    0.10.0                   py27_0    conda-forge
freetype                  2.6.3                         1    conda-forge
functools32               3.2.3.2                  py27_1    conda-forge
libgfortran               3.0.0                         0    conda-forge
Searching for a certain package
```
Some packages might not be available in conda, but are available in pypi. For example, we will search for rasterio within the anaconda cloud. It is not necessary to create an account with anaconda cloud, unless you'd like to contribute in the future when you are pro with conda.


---
## Managing Packages
In this example, we will use rasterio from conda-forge. The anaconda cloud page for rasterio will show how to install the package, compatible OS, individual files for that package, etc.

With conda you can do this search within the command line:
```
conda search rasterio
```
Using Anaconda Cloud api site https://api.anaconda.org
Run 'anaconda show <USER/PACKAGE>' to get more details:
```
Packages:
     Name                      |  Version | Package Types   | Platforms      
     ------------------------- |   ------ | --------------- | ---------------
     IOOS/rasterio             |    1.0a2 | conda           | linux-64, win-32, win-64, osx-64
     Terradue/rasterio         |   0.32.0 | conda           | linux-64       
                                          : Fast and direct raster I/O for use with Numpy and SciPy
     anaconda/rasterio         |   0.36.0 | conda           | linux-64, win-32, win-64, linux-32, osx-64
     conda-forge/rasterio      |    1.0a2 | conda           | linux-64, win-32, win-64, osx-64
                                          : Rasterio reads and writes geospatial raster datasets
     dharhas/rasterio          |   0.23.0 | conda           | win-64         
                                          : Rasterio reads and writes geospatial raster datasets.
     erdc/rasterio             |   0.23.0 | conda           | win-64         
                                          : Rasterio reads and writes geospatial raster datasets.
     jesserobertson/rasterio   |   0.23.0 | conda           | linux-64, linux-32, osx-64
     jhamman/rasterio_to_xarray | 2016.03.16-1558 | ipynb           |                
                                          : IPython notebook
     krisvanneste/rasterio     |   0.26.0 | conda           | win-64         
     ocefpaf/rasterio          |   0.19.1 | conda           | linux-64, osx-64
     omgarcia/rasterio         |   0.25.0 | conda           | linux-64       
     pypi/rasterio             |   0.13.2 | pypi            |                
                                          : Fast and direct raster I/O for Python programmers who use Numpy
     robintw/rasterio          |   0.35.1 | conda           | osx-64         
                                          : Rasterio reads and writes geospatial raster datasets
     sgillies/rasterio         |     0.15 | conda           | osx-64         
     ztessler/rasterio         |   0.31.0 | conda           | osx-64         
                                          : Fast and direct raster I/O for use with Numpy and SciPy
Found 15 packages
Installing conda package
```
---

## Managing conda

Under the name column of the result in the terminal or the package column in the Anaconda Cloud listing, shows the necessary information to install the package. e.g. conda-forge/rasterio. The first word list the channel that this package is from and the second part shows the name of the package.

To install the latest version available within the channel, do not specify in the install command. We will install version 0.35 of rasterio from conda-forge into test_env in this example. Conda will also automatically install the dependencies for this package.
```
conda install -c conda-forge rasterio=0.35
```
If you have a few trusted channels that you prefer to use, you can pre-configure these so that everytime you are creating an environment, you won't need to explicitly declare the channel.
```
conda config --add channels conda-forge
```

---
### Removing a conda Package
We decided that rasterio is not needed in this tutorial, so we will remove it from test_env. Note that this will remove the main package rasterio and its dependencies (unless a dependency was installed explicitly at an earlier point in time or is required be another package).
```
conda remove -n test_env rasterio
```
```
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata .........
Solving package specifications: ..........

Package plan for package removal in environment //anaconda/envs/test_env:

The following packages will be REMOVED:

    rasterio: 0.35.1-np111py27_1 conda-forge

Proceed ([y]/n)? y

Unlinking packages ...
[      COMPLETE      ]|#######################################################################################################| 100%

```
Remeber that when you forget a specific command you can type in the help command we have created mds-help in you terminal to see a list of all commands we use in MDS.


---

# R environments
In R, environments are managed by renv, which works with similar principles as conda, and other virtual environment managers, but the commands are different. To see which commands are used in renv, you can visit the project website. Briefly, renv::init() is used to create a new env, renv::snapshot is used to save/export the environment to a file (renv.lock), and installing and removing packages are done as usual via the install.packages() and remove.packages() commands.

---

## References

.bg-washed-blue.b--dark-blue.ba.bw2.br3.shadow-5.ph4.mt5[

 [Elegant, flexible, and fast dynamic report generation with R](https://yihui.org/knitr/)
 
 [GitHub repo `here` package](https://github.com/jennybc/here_here)
 
 [GitHub repo `xaringan` package](https://github.com/yihui/xaringan)
 
 [GitHub repo `xaringanthemer` package](https://pkg.garrickadenbuie.com/xaringanthemer/)

 [R Markdown documents](https://rmarkdown.rstudio.com/)

 [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)
 
 [RStudio oficial - Distill for RMarkdown](https://rstudio.github.io/distill)


]


---


class: inverse, middle, center


## Thank you!
