<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>DSCI 521 - Lecture 8</title>
    <meta charset="utf-8" />
    <meta name="author" content="MDS 2021/22" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/js-cookie/js.cookie.js"></script>
    <script src="libs/peerjs/peerjs.min.js"></script>
    <script src="libs/tiny.toast/toast.min.js"></script>
    <link href="libs/xaringanExtra-broadcast/broadcast.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-broadcast/broadcast.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <script src="libs/xaringanExtra_fit-screen/fit-screen.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">











class: middle, center

&lt;img src="img/hex.png" width="150" style="display: block; margin: auto;" /&gt;


---


class: bottom

.bg-washed-blue.b--dark-blue.ba.bw2.br3.shadow-5.ph4.mt5[
### DSCI 521 - Lecture 8 
### **Getting help, virtual environments, and some tips and tricks**

 .large[#### Computing Platforms for Data Science - UBC MDS 2021/22
]]


---

## Lecture learning goals

1. Access function **documentation**.
--

2. **Ask questions** effectively.

--
3. Create a **minimal reproducible examples**.

--
4. Manage **virtual environments** with conda and renv.
---

class: middle, inverse

## Accessing help in R and Python

---
## Accessing help in R and Python

##### R and Python

- Preface a function `?` to view the documentation. e.g. ?len or ?seq. 


##### shortcuts 
- In **RStudio**, you can press `F1`  

- In **JupyterLab**, you can press `Shift` + `TAB` or have the **contextual help** open on the side as you type.

---

## Asking effective questions
#### Why even bother?
- Asking questions effectively means that the person helping you will be able to answer your question **better and quicker**.

- When you are asking for help online, remember that you are often receiving help from people who are **volunteering their time**. 

---

You might be frustrated by a problem...
--

### WHY IS THIS CODE NOT WORKING??????

![](https://media.giphy.com/media/H8bzCgnzMVgWs/giphy.gif?cid=ecf05e47wjn3hub1dqr7tx5i28iu25b30hwelonsy73ycc2i&amp;rid=giphy.gif&amp;ct=g)

Don't do this.
No one will help you.
You will get more frustrated.

---


&lt;img src="img/code_hero.jpg" width="600" style="display: block; margin: auto;" /&gt;

.footnote[[Illustration by Alison Horst](https://github.com/allisonhorst)]


---

class: middle

### Writing down questions properly has another superb quality: they help you solve your own problems


---

class: middle, inverse, center

## How to ask effectively
---
class: middle
##### In essence, you want to make your question as **easy to understand** as possible and your specific problem as **easy to reproduce** as possible. .

---
### Minimal reproducible example

Also known as...

- **MRE** Minimal Reproducible Example
- **MCVE** Minimal Complete Verifiable Example
- **MWE** Minimal Working Example
- **reprex** REPRoducible EXample



---

### Minimal reproducible example

-  Search for other questions similar to yours.


&gt; Tip! Search like a Pro

&lt;img src="img/google-search.jpg" width="500" style="display: block; margin: auto;" /&gt;
.footnote[[Image extracted from 23 Google Search Tips You'll Want to Learn - PCMAG](https://www.pcmag.com/how-to/23-google-search-tips-youll-want-to-learn)]


---
### Minimal reproducible example
-  Search for other questions similar to yours.

&lt;img src="slides_files/figure-html/tw-1.png" width="500" style="display: block; margin: auto;" /&gt;
.footnote[[Tweet](https://twitter.com/denicmarko/status/1434817434771406848?s=09)]

---
### Minimal reproducible example
-  Search for other questions similar to yours.

&lt;img src="img/google-search2.jpg" width="400" style="display: block; margin: auto;" /&gt;


.footnote[[Tweet](https://twitter.com/CatchTheBaby/status/1432124463399641088)]

---

### Minimal reproducible example
-  Search for other questions similar to yours.

&gt; Other tip! Are you including all the keywords?



---

### Minimal reproducible example
- Describe the issue clearly in the title and elaborate briefly in the text body.



&lt;img src="img/questions.png" width="500" style="display: block; margin: auto;" /&gt;

.footnote[[How do I ask a good question](https://stackoverflow.com/help/how-to-ask)]

---
### Minimal reproducible example
- Reduce the code to the **minimum required** to recreate your error, and paste it as text.
- If your code includes functions or classes, **include their definitions**.

---
### Minimal reproducible example

- Create small toy dataset instead of using real data.

--
### How do to share a dataset in a forum?

---

---
### Minimal reproducible example

- Create small toy dataset instead of using real data.

&gt; Tip! There are functions that help you to share datasets easily!

#### R

- `dput()`

- `datapasta` package

#### Python

- Python https://stackoverflow.com/questions/47450931/print-pandas-data-frame-for-reproducible-example-equivalent-to-dput-in-r

---


### Minimal reproducible example

- Use **markdown code blocks** for proper indentation and syntax highlighting.
- **Inline code** should be surrounded by **single backticks** for clarity. 


---
### Minimal reproducible example
- Describe what you have tried so far, what you don't understand or what went wrong, including any **error messages** and their full traceback.

--

- The points are elaborated on below:
- **Search for other questions similar to yours**
  
--
  - **Write the title as a summary of your issue** 
  Just "Error" or "Question" is not helpful, but "How to list content in a folder?" is.
--
  - **Introduce the problem by briefly describing what you want to do.**

---


### Minimal reproducible example

- **Show what you have tried**, explain what you expected to happen, and what went wrong. It is often critical that the person helping you can reproduce the problem, so include both the code or command you tried to run and the error message.
- For coding questions, **text is preferred over a screenshot** since it is easy to copy and paste, which facilitates **reproducing** your problem.


---

### Minimal reproducible example

---

### Minimal reproducible example

- **Include versions of any packages you are using**, and the operating system if relevant, e.g. Win10, Python 3.8, pandas 1.0.2. 


### R 
`devtools::session_info()` to see this information 
(after `install.packages("devtools")`) 


### Python 
`sinfo()` 
(after importing: from `sinfo` import `sinfo`, needs to be installed via `pip install sinfo`).

---

### Minimal reproducible example

- **When your problem is solved, acknowledge the solution**, close the issue/ticket/question. If you found the solution yourself, post it in a comment before closing, so that others can find it.



---

class: middle, center, inverse

### Virtual environments

---

## Virtual environments

- You can have multiple versions of packages and programs on the same computer without them creating conflicts with each other.


- You will be using virtual **Python** and **R environments** throughout the program to setup your packages for different courses.

---

## Conda 

- **conda** is an **open source package** and **environment management system** for any programming language

- It is the most popular in the python community. 

---
## Conda

&lt;img src="img/miniconda_vs_anaconda.png" width="500" style="display: block; margin: auto;" /&gt;

- **Anaconda** is a data science platform for Python that comes with a lot of packages by default. 
- **Miniconda** doesn't come with any installed packages by default, and we can pick and choose which ones we want. 

Both include Python and conda.


.footnote[[Introduction to Conda for (Data) Scientists - Software Carpentry](https://carpentries-incubator.github.io/introduction-to-conda-for-data-scientists/01-getting-started-with-conda/index.html)]

---

## Managing Conda


What version of conda is installed?

```
conda --version
```
Conda commands are available, type conda --help. 

```
conda update --help
```
- Update our conda to the latest version: 

```
conda update conda
```



---

## Managing Conda

```
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata: ....
.Solving package specifications: .........

Package plan for installation in environment //anaconda:

The following packages will be downloaded:

    package                    |            build
    ---------------------------|-----------------
    conda-env-2.6.0            |                0          601 B
    ruamel_yaml-0.11.14        |           py27_0         184 KB
    conda-4.2.12               |           py27_0         376 KB
    ------------------------------------------------------------
                                           Total:         560 KB

```

---

class: middle, center

### What is a conda environment and why is it so useful?
Using conda, you can create an `isolated python environment for your project`. 


---

## What is an Environment?
- An environment is a set of packages that can be used in one or multiple projects.

--
##### **Benefits** of using environments:
  - You can guarantee that someone else can reproduce your project by specifying which package versions your used.
--
  - If two of your projects relies on different versions of the same package, you can install these in different environments.
--
  - If you want to play around with a new package, you don't have to change the packages you use for your data analysis and risk messing something up.
--
  - When you develop your own packages, it is essential to use environments, since you want to to make sure you know exactly which packages yours depend on, so that it runs on other systems than your own.


---

## Base environment

Conda has a default environment called **base**
- that include a Python installation and
- some core system libraries and dependencies of Conda. 

It is a **“best practice”** to avoid installing additional packages into your base software environment. 
 

---

## Creating Conda environments

There are two ways of creating a conda environment.

1. Creating environment by manually specifying packages  

--
2. An environment file in YAML format (*environment.yaml*).

---

## Creating Conda environments
#### 1. Creating environment by manually specifying packages
We can create `test_env` conda environment by typing `conda -n &lt;name-of-env&gt;`. 

```
conda create -n test_env -c conda-forge python=3.7 jupyterlab pandas=1.0.2
```
- conda will solve any dependencies between the packages like before and create a new environment with those packages. 
- Usually, we don't need to specify the channel, but in this case I want to get the very latest version of these packages, and they are made available in `conda-forge` before they reach the default conda channel.

---
## Creating Conda environments
#### 1. Creating environment by manually specifying packages

To activate this new environment, you can type

```
conda activate test_env 
```

```
conda deactivate 
```

To see all your environments, you can type:

```
conda env list
```
---
## Creating Conda environments
#### 2. An environment file in YAML format (*environment.yaml*).

Exporting your environment to a file called `environment.yaml` (it could be called anything, but this is the conventional name and using it makes it easy for others to recognize that this is a conda env file, the extension can be either .yaml or .yml):

---


## Sharing Environments with others
Export your conda environment to an environment file, which will list each package and its version.


```
conda env export -f environment.yaml
```
Remember that `.yaml` files are plain text, so you can use a text editor such as VS Code to open them. 


---
## Sharing Environments with others
The environment file has A LOT more packages than jupyterlab and pandas. 

list the dependencies that were installed together with these packages, e.g. numpy. 

This is good in the sense that it gives an **exact copy of everything in your environment**.


---

## Sharing Environments with others

Exporting your environment to a file called **environment.yaml** (the extension can be either `.yaml` or `.yml`):

```
conda env export -f environment.yaml
```
---
## Sharing Environments with others
Some dependencies might differ between operating systems,append the 
`--from-history flag` which look at the history of the packages you explicitly told conda to install and only list those in the export. 

The required dependencies will then be handled in an **OS-specific manner during the installation**, which guarantees that they will work across OSes. 

This `environment.yaml` file would be much shorter:

```
name: test_env
channels:
  - conda-forge
  - defaults
dependencies:
  - conda
  - python=3.7
  - pandas==1.0.2
  - jupyterlab
```
Importantly, this will not include the package version unless you included it when you installed with the package==version syntax. 

##### For an environment to be reproducible, you NEED to add the version string manually.

---
### Creating environment from an environment file
Now, let's install `environment.yaml` environment file above so that we can create a conda environment called `test_env`.
```
$ conda env create --file environment.yaml
```
---

## Copying an environment

We can make an exact copy of an environment to an environment with a different name. This maybe useful for any testing versus live environments or different Python 2.7 versions for the same packages. In this example, test_env is cloned to create live_env.
```
conda create --name live_env --clone test_env
```

---
## Deleting an environment
Since we are only testing out our environment, we will delete live_env.
```
conda env remove -n live_env
```

---

## Making environments work well with JupyterLab
In brief, you need to install the `ipykernel` package in any new environment your create, and the nb_conda_kernels package needs to be installed in the environment where JupyterLab is installed.

By default, JupyterLab only sees the conda environment where it is installed. Since it is quite annoying to install JupyterLab and its extensions separately in each environment, there is a package called nb_conda_kernels that makes it possible to have a single installation of JupyterLab access kernels in other conda environments. This package needs to be installed in the conda environment where JupyterLab is installed.

Lastly, you also need to install a kernel in the new conda environment so that it can be detected by nb_conda_kernels. This kernel can be installed via the package ipykernel for Python and the r-irkernel package for R (more info in the nb_conda_kernels README).
---
## Managing Packages
#### Seeing what packages are available
We will now check packages that are available to us. The command below will list all the packages in an environment, in this case test_env. The list will include versions of each package, the specific build, and the channel that the package was downloaded from. conda list is also useful to ensure that you have installed the packages that you desire.

```bash
conda list
```

```bash
# packages in environment at //miniconda/envs/test_env:
#
Using Anaconda Cloud api site https://api.anaconda.org
blas                      1.1                    openblas    conda-forge
ca-certificates           2016.9.26                     0    conda-forge
certifi                   2016.9.26                py27_0    conda-forge
cycler                    0.10.0                   py27_0    conda-forge
freetype                  2.6.3                         1    conda-forge
functools32               3.2.3.2                  py27_1    conda-forge
libgfortran               3.0.0                         0    conda-forge
Searching for a certain package
```
Some packages might not be available in conda, but are available in `pypi`. For example, we will search for rasterio within the anaconda cloud. It is not necessary to create an account with anaconda cloud, unless you'd like to contribute in the future when you are pro with conda.


---
## Managing Packages
In this example, we will use `rasterio` from `conda-forge`. 

With conda you can do this search within the command line:
```
conda search rasterio
```
Using Anaconda Cloud api site https://api.anaconda.org
Run 'anaconda show &lt;USER/PACKAGE&gt;' to get more details:
```
Packages:
     Name                      |  Version | Package Types   | Platforms      
     ------------------------- |   ------ | --------------- | ---------------
     IOOS/rasterio             |    1.0a2 | conda           | linux-64, win-32, win-64, osx-64
     Terradue/rasterio         |   0.32.0 | conda           | linux-64       
                                          : Fast and direct raster I/O for use with Numpy and SciPy
     anaconda/rasterio         |   0.36.0 | conda           | linux-64, win-32, win-64, linux-32, osx-64
     conda-forge/rasterio      |    1.0a2 | conda           | linux-64, win-32, win-64, osx-64
                                          : Rasterio reads and writes geospatial raster datasets
     dharhas/rasterio          |   0.23.0 | conda           | win-64         
                                          : Rasterio reads and writes geospatial raster datasets.
     erdc/rasterio             |   0.23.0 | conda           | win-64         
                                          : Rasterio reads and writes geospatial raster datasets.
     jesserobertson/rasterio   |   0.23.0 | conda           | linux-64, linux-32, osx-64
     jhamman/rasterio_to_xarray | 2016.03.16-1558 | ipynb           |                
                                          : IPython notebook
     krisvanneste/rasterio     |   0.26.0 | conda           | win-64         
     ocefpaf/rasterio          |   0.19.1 | conda           | linux-64, osx-64
     omgarcia/rasterio         |   0.25.0 | conda           | linux-64       
     pypi/rasterio             |   0.13.2 | pypi            |                
                                          : Fast and direct raster I/O for Python programmers who use Numpy
     robintw/rasterio          |   0.35.1 | conda           | osx-64         
                                          : Rasterio reads and writes geospatial raster datasets
     sgillies/rasterio         |     0.15 | conda           | osx-64         
     ztessler/rasterio         |   0.31.0 | conda           | osx-64         
                                          : Fast and direct raster I/O for use with Numpy and SciPy
Found 15 packages
Installing conda package
```
---

## Managing conda

Under the name column of the result in the terminal or the package column in the Anaconda Cloud listing, shows the necessary information to install the package. e.g. conda-forge/rasterio. The first word list the channel that this package is from and the second part shows the name of the package.

To install the latest version available within the channel, do not specify in the install command. We will install version 0.35 of rasterio from conda-forge into test_env in this example. Conda will also automatically install the dependencies for this package.
```
conda install -c conda-forge rasterio=0.35
```
If you have a few trusted channels that you prefer to use, you can pre-configure these so that everytime you are creating an environment, you won't need to explicitly declare the channel.
```
conda config --add channels conda-forge
```

---
### Removing a conda Package
Note that this will remove the main package `rasterio` and its dependencies (unless a dependency was installed explicitly at an earlier point in time or is required be another package).
```
conda remove -n test_env rasterio
```
```
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata .........
Solving package specifications: ..........

Package plan for package removal in environment //anaconda/envs/test_env:

The following packages will be REMOVED:

    rasterio: 0.35.1-np111py27_1 conda-forge

Proceed ([y]/n)? y

Unlinking packages ...
[      COMPLETE      ]|#######################################################################################################| 100%

```
Remeber that when you forget a specific command you can type in the help command we have created mds-help in you terminal to see a list of all commands we use in MDS.


---

# R environments
In R, environments are managed by `renv`, which works with similar principles as `conda`, and other virtual environment managers, but the commands are different.

---

## References

.bg-washed-blue.b--dark-blue.ba.bw2.br3.shadow-5.ph4.mt5[
https://stackoverflow.com/help/how-to-ask
https://stackoverflow.com/help/minimal-reproducible-example
https://community.rstudio.com/t/faq-whats-a-reproducible-example-reprex-and-how-do-i-do-one/5219
https://reprex.tidyverse.org/ (an R package to help creating MREs from code)
In summary, asking effectively and creating an MRE includes the following tasks:
renv
conda
the carprntries
 [Elegant, flexible, and fast dynamic report generation with R](https://yihui.org/knitr/)
 
 [GitHub repo `here` package](https://github.com/jennybc/here_here)
 
 [GitHub repo `xaringan` package](https://github.com/yihui/xaringan)
 
 [GitHub repo `xaringanthemer` package](https://pkg.garrickadenbuie.com/xaringanthemer/)

 [R Markdown documents](https://rmarkdown.rstudio.com/)

 [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)
 
 [RStudio oficial - Distill for RMarkdown](https://rstudio.github.io/distill)


]


---


class: inverse, middle, center


## Thank you!
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
